import{I as E,M as A,a as $,g as G,c as I,b as M,v as T,e as k,O as R,B as F,S as P,F as S,V as D,r as g,u as V,j as i,d as z,C as L,E as O,f as X,G as Y,h as B,i as K,N as Z,P as Q,L as W}from"./index-D1zxb4fF.js";function q(s){let t=[],e="";const n=I(s,{chained:!0,customRewriter({vertexShader:o,fragmentShader:r}){let a=[],c=[],l=[],m=M(o),f=M(r);return t.forEach(p=>{let d=m[p],u=f[p];const x=d||u;if(x){const U=new RegExp(`\\buniform\\s+${x}\\s+${p}\\s*;`,"g"),_=new RegExp(`\\b${p}\\b`,"g"),v=`troika_attr_${p}`,j=`troika_vary_${p}`;if(a.push(`attribute ${x} ${v};`),d&&(o=o.replace(U,""),o=o.replace(_,v)),u){r=r.replace(U,""),r=r.replace(_,j);let w=`varying ${u} ${j};`;a.push(w),l.push(w),c.push(`${j} = ${v};`)}}}),o=`${a.join(`
`)}
${o.replace(T,`
$&
${c.join(`
`)}`)}`,l.length&&(r=`${l.join(`
`)}
${r}`),{vertexShader:o,fragmentShader:r}}});n.setUniformNames=function(o){t=o||[];const r=t.sort().join("|");r!==e&&(e=r,this.needsUpdate=!0)};const h=n.customProgramCacheKey();return n.customProgramCacheKey=function(){return h+"|"+e},n.isInstancedUniformsMaterial=!0,n}class H extends E{constructor(t,e,n){super(t,e,n),this._maxCount=n,this._instancedUniformNames=[]}get geometry(){let t=this._derivedGeometry;const e=this._baseGeometry;return(!t||t.baseGeometry!==e)&&(t=this._derivedGeometry=Object.create(e),t.baseGeometry=e,t.attributes=Object.create(e.attributes),e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),t.dispose()})),t}set geometry(t){this._baseGeometry=t}get material(){let t=this._derivedMaterial;const e=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=new A);return(!t||t.baseMaterial!==e)&&(t=this._derivedMaterial=q(e),e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),t.dispose()})),t.setUniformNames(this._instancedUniformNames),t}set material(t){if(Array.isArray(t))throw new Error("InstancedUniformsMesh does not support multiple materials");for(;t&&t.isInstancedUniformsMaterial;)t=t.baseMaterial;this._baseMaterial=t}get customDepthMaterial(){return this.material.getDepthMaterial()}get customDistanceMaterial(){return this.material.getDistanceMaterial()}setUniformAt(t,e,n){const h=this.geometry.attributes,o=`troika_attr_${t}`;let r=h[o];if(!r){const a=J(this._baseMaterial,t),c=ee(a);if(r=h[o]=new $(new Float32Array(c*this._maxCount),c),a!==null)for(let l=0;l<this._maxCount;l++)C(r,l,a);this._instancedUniformNames=[...this._instancedUniformNames,t]}C(r,e,n),r.needsUpdate=!0}unsetUniform(t){this.geometry.deleteAttribute(`troika_attr_${t}`),this._instancedUniformNames=this._instancedUniformNames.filter(e=>e!==t)}}function C(s,t,e){let n=s.itemSize;n===1?s.setX(t,e):n===2?s.setXY(t,e.x,e.y):n===3?e.isColor?s.setXYZ(t,e.r,e.g,e.b):s.setXYZ(t,e.x,e.y,e.z):n===4?s.setXYZW(t,e.x,e.y,e.z,e.w):e.toArray?e.toArray(s.array,t*n):s.set(e,t*n)}function J(s,t){let e=s.uniforms;return e&&e[t]||(e=G(s).uniforms,e&&e[t])?e[t].value:null}function ee(s){return s==null?0:typeof s=="number"?1:s.isVector2?2:s.isVector3||s.isColor?3:s.isVector4||s.isQuaternion?4:s.elements?s.elements.length:Array.isArray(s)?s.length:0}k({InstancedUniformsMesh:H});const y=new R,b=new D,te=`
  varying vec2 vUv;

  void main() {
    vUv = uv;
    vec4 mvPosition = vec4( position, 1.0 );

    #ifdef USE_INSTANCING
      mvPosition = instanceMatrix * mvPosition;
    #endif

    gl_Position = projectionMatrix * modelViewMatrix * mvPosition;
  }
`,se=`
  varying vec2 vUv;
  uniform float uTime;
  uniform vec2 uUv;

  void main() {
    // gl_FragColor = vec4(uUv.x, 1.-uUv.y, sin(uTime), 1.);
    gl_FragColor = vec4(0.5 + 0.5*cos(uTime+uUv.xyx+vec3(0,2,4)), 1.);
    #include <tonemapping_fragment>
    // #include <encodings_fragment>
  }
`,N={uTime:{value:1},uUv:{value:new D(0,0)}},ie=new F(.88,2,.88),ne=new P({uniforms:N,side:S,vertexShader:te,fragmentShader:se}),re=s=>{const t=g.useRef(),{resolution:e,imgData:n}=s;return g.useEffect(()=>{console.log(n)},[n]),V(h=>{if(!t.current)return;const o=h.clock.getElapsedTime();N.uTime.value=o;let r=0,a=0;for(let c=0;c<e;c++)for(let l=0;l<e;l++){const m=r++;if(b.set(l/e,c/e),y.position.set(-e/2+l,0,-e/2+c),n){const f=(255-n[a])/255*e/30;y.scale.setY(Math.max(f,.1))}a+=4,y.updateMatrix(),t.current.setMatrixAt(m,y.matrix),t.current.setUniformAt("uUv",m,b)}t.current.instanceMatrix.needsUpdate=!0}),i.jsx("instancedUniformsMesh",{ref:t,args:[ie,ne,e*e]})},ae=()=>{const s=g.useRef(""),[t,e]=g.useState(""),[n,h]=g.useState(""),[o,r]=g.useState(),{resolution:a}=z({resolution:{value:30,options:[10,20,30,40,50,60,70,80,100]}}),c=l=>{s.current=l;const m=document.createElement("canvas");m.width=m.height=500;const f=m.getContext("2d");f.fillStyle="white",f.fillRect(0,0,500,500),f.font="bold 400px Noto Sans TC",f.fillStyle="black",f.textAlign="center",f.fillText(l,250,410,500);const p=m.toDataURL();e(p);const d=document.createElement("canvas");d.width=a,d.height=a;const u=d.getContext("2d");u.fillStyle="white",u.fillRect(0,0,500,500),u.imageSmoothingEnabled=!0,u.drawImage(m,0,0,m.width,m.height,0,0,d.width,d.height);const x=d.toDataURL();h(x),r(u.getImageData(0,0,a,a).data)};return g.useEffect(()=>{s.current&&c(s.current)},[a]),i.jsxs(i.Fragment,{children:[i.jsxs(g.Suspense,{children:[i.jsxs("div",{className:"ui-panel",children:[i.jsx("h2",{children:"Choose a charactor : "}),i.jsxs("ul",{children:[i.jsx("li",{onClick:()=>c("G"),children:"G"}),i.jsx("li",{onClick:()=>c("中"),children:"中"}),i.jsx("li",{onClick:()=>c("あ"),children:"あ"}),i.jsx("li",{onClick:()=>c("한"),children:"한"})]}),t?i.jsxs("div",{className:"flow",children:[i.jsxs("div",{className:"item",children:[i.jsx("h3",{children:"Texture preview : "}),i.jsx("img",{src:t,alt:"",width:"100px"})]}),i.jsx("div",{className:"item",children:i.jsx("span",{className:"arrow",children:"→"})}),i.jsxs("div",{className:"item",children:[i.jsx("h3",{children:"Downsampling : "}),i.jsx("img",{src:n,alt:"",width:"100px"})]})]}):null]}),i.jsxs(L,{camera:{position:[-8,32,40],fov:45},children:[i.jsx("directionalLight",{position:[0,5,0],intensity:4}),i.jsx(O,{files:"./sunset.hdr",environmentIntensity:1}),i.jsx(X,{top:!0,children:i.jsx(re,{resolution:a,imgData:o})}),i.jsx(Y,{renderOrder:-1,position:[0,0,0],infiniteGrid:!0,cellSize:.6,cellThickness:.6,sectionSize:3.3,sectionThickness:1.5,sectionColor:"#181818",fadeDistance:1e3}),i.jsx(B,{makeDefault:!0,enabled:!0,maxPolarAngle:Math.PI/3,minDistance:20,maxDistance:180}),i.jsx(K,{children:i.jsx(Z,{distanceFalloff:1,aoRadius:2,intensity:1})}),i.jsx(Q,{position:"top-left"})]})]}),i.jsx(W,{})]})};export{ae as default};
